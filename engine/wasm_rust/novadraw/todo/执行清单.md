# Novadraw æ‰§è¡Œæ¸…å•

## é¡¹ç›®ç›®æ ‡

å®ç°ç±»ä¼¼ Eclipse Draw2D/GEF çš„çŸ¢é‡å›¾ç»˜å›¾å¼•æ“ï¼ŒåŸºäº WebGPU æŠ€æœ¯æ ˆï¼Œæ”¯æŒ macOS/Windowsã€Web å¹³å°ã€‚

---

## å½“å‰æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      novadraw                                â”‚
â”‚  (workspace åè°ƒè€…ï¼Œä»…ç»„åˆå­ crate)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼             â–¼       â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚novadraw-math â”‚ â”‚novadraw- â”‚ â”‚ novadraw- â”‚ â”‚  novadraw-   â”‚
â”‚   æ•°å­¦åº“      â”‚ â”‚  core    â”‚ â”‚  render   â”‚ â”‚   scene      â”‚
â”‚              â”‚ â”‚  æ ¸å¿ƒ    â”‚ â”‚  æ¸²æŸ“å±‚   â”‚ â”‚   åœºæ™¯å›¾      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚â€¢ Vec2/Vec3   â”‚ â”‚â€¢ Color   â”‚ â”‚â€¢ RenderCmdâ”‚ â”‚â€¢ Figure      â”‚
â”‚â€¢ Mat3        â”‚ â”‚          â”‚ â”‚â€¢ RenderCtxâ”‚ â”‚â€¢ SceneGraph  â”‚
â”‚â€¢ Rect/Point  â”‚ â”‚          â”‚ â”‚â€¢ Renderer â”‚ â”‚â€¢ Viewport    â”‚
â”‚â€¢ Transform   â”‚ â”‚          â”‚ â”‚â€¢ Vello    â”‚ â”‚â€¢ LayoutMgr   â”‚
â”‚â€¢ Translatableâ”‚ â”‚          â”‚ â”‚           â”‚ â”‚â€¢ RuntimeBlockâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                          â–¼                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     å¾…å®š      â”‚ â”‚  apps/editor â”‚
                    â”‚   GEF æ¡†æ¶    â”‚ â”‚  ç¼–è¾‘å™¨åº”ç”¨   â”‚
                    â”‚  (å¾…å®ç°)     â”‚ â”‚â€¢ winit çª—å£  â”‚
                    â”‚              â”‚ â”‚â€¢ SceneMgr    â”‚
                    â”‚              â”‚ â”‚â€¢ äº‹ä»¶å¤„ç†    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ¨¡å—çŠ¶æ€æ€»è§ˆ

| æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| **novadraw-math** | âœ… å®Œæˆ | Vec2, Vec3, Mat3, Rect, Point, Transform, Translatable |
| **novadraw-core** | âœ… å®Œæˆ | Color é¢œè‰²ç±»å‹ |
| **novadraw-render** | âœ… å®Œæˆ | RenderCommand, RenderContext, VelloRenderer, NdCanvas |
| **novadraw-scene** | âœ… å®Œæˆ | Figure trait, RectangleFigure, SceneGraph, Viewport |
| **novadraw-gef** | âŒ å·²åˆ é™¤ | Command, EditPart, EditPolicy, Toolï¼ˆå¾…é‡æ–°è®¾è®¡ï¼‰ |

---

## å·²å®ŒæˆåŠŸèƒ½ âœ…

### novadraw-mathï¼ˆæ•°å­¦åº“ï¼‰

- [x] **Vec2** - 2D å‘é‡ç±»å‹
- [x] **Vec3** - 3D å‘é‡ç±»å‹
- [x] **Mat3** - 3x3 çŸ©é˜µç±»å‹
- [x] **Rect/Point/Size** - çŸ©å½¢ã€ç‚¹ã€å°ºå¯¸
- [x] **Transform** - å˜æ¢çŸ©é˜µï¼ˆå¹³ç§»ã€ç¼©æ”¾ï¼‰
- [x] **Translatable** - å¯å¹³ç§» trait

### novadraw-coreï¼ˆæ ¸å¿ƒï¼‰

- [x] **Color** - RGBA é¢œè‰²ç±»å‹

### novadraw-renderï¼ˆæ¸²æŸ“å±‚ï¼‰

- [x] **RenderCommand** - æ¸²æŸ“å‘½ä»¤ IR
- [x] **RenderContext** - æ¸²æŸ“ä¸Šä¸‹æ–‡
- [x] **NdCanvas** - Canvas ç»˜å›¾æ¥å£
- [x] **Renderer trait** - æ¸²æŸ“å™¨æ¥å£
- [x] **WindowProxy trait** - çª—å£æŠ½è±¡æ¥å£
- [x] **VelloRenderer** - Vello åç«¯å®ç°ï¼ˆæ”¯æŒ winitï¼‰
- [x] **WinitWindowProxy** - winit çª—å£é€‚é…å™¨

### novadraw-sceneï¼ˆåœºæ™¯å›¾ï¼‰

- [x] **Figure trait** - å›¾å½¢æ¥å£ï¼ˆç®€åŒ–ç‰ˆï¼‰
- [x] **RectangleFigure** - çŸ©å½¢å›¾å½¢
- [x] **BaseFigure** - åŸºç¡€å›¾å½¢
- [x] **SceneGraph** - åœºæ™¯å›¾ç®¡ç†ï¼ˆè¿­ä»£éå†ï¼‰
- [x] **RuntimeBlock** - è¿è¡Œæ—¶å—
- [x] **BlockId** - SlotMap é«˜é€Ÿç´¢å¼•
- [x] **Viewport** - è§†å£ç®¡ç†ï¼ˆå¹³ç§»ã€ç¼©æ”¾ã€åæ ‡è½¬æ¢ï¼‰

### apps/editorï¼ˆç¼–è¾‘å™¨ï¼‰

- [x] **winit çª—å£ç®¡ç†** - äº‹ä»¶å¾ªç¯ã€çª—å£åˆ›å»º
- [x] **SceneManager** - åœºæ™¯ç®¡ç†
- [x] **äº‹ä»¶å¤„ç†** - é¼ æ ‡ã€é”®ç›˜
- [x] **åæ ‡è½¬æ¢** - å±å¹• â†” ä¸–ç•Œåæ ‡

---

## å¾…å®ç°åŠŸèƒ½

### é˜¶æ®µä¸€ï¼šåŸºç¡€ Figure æ‰©å±•

#### åŸºç¡€å›¾å½¢

- [ ] **EllipseFigure**ï¼ˆæ¤­åœ†ï¼‰- æ¤­åœ†ç»˜åˆ¶
- [ ] **CircleFigure**ï¼ˆåœ†å½¢ï¼‰- åœ†å½¢ç»˜åˆ¶
- [ ] **LineFigure**ï¼ˆç›´çº¿ï¼‰- ç›´çº¿ç»˜åˆ¶

#### æ¸²æŸ“å±æ€§

- [ ] **Stroke å±æ€§** - è¾¹æ¡†å®½åº¦ã€é¢œè‰²
- [ ] **Fill å±æ€§** - çº¯è‰²å¡«å……ï¼ˆRectangleFigure å·²æœ‰ï¼‰
- [ ] **LineFigure** å®ç° - ç‹¬ç«‹ç›´çº¿å›¾å½¢

### é˜¶æ®µäºŒï¼šè·¯å¾„ç³»ç»Ÿ

- [ ] **PathFigure**ï¼ˆè´å¡å°”è·¯å¾„ï¼‰
  - MoveTo, LineTo å‘½ä»¤
  - Bezier, Quadratic æ›²çº¿
  - æè¾¹æ”¯æŒ

### é˜¶æ®µä¸‰ï¼šç¼–è¾‘å™¨å·¥å…·

#### åŸºç¡€å·¥å…·

- [ ] **SelectionTool** - é€‰æ‹©å›¾å½¢
- [ ] **DragEditPolicy** - æ‹–æ‹½ç§»åŠ¨
- [ ] **ResizeEditPolicy** - è°ƒæ•´å¤§å°

#### åˆ›å»ºå·¥å…·

- [ ] **RectangleCreationTool** - çŸ©å½¢åˆ›å»º
- [ ] **EllipseCreationTool** - æ¤­åœ†åˆ›å»º
- [ ] **LineCreationTool** - ç›´çº¿åˆ›å»º

### é˜¶æ®µå››ï¼šGEF æ¡†æ¶ï¼ˆé‡æ–°è®¾è®¡ï¼‰

- [ ] **Command trait** - å‘½ä»¤æ¨¡å¼
- [ ] **CommandStack** - Undo/Redo
- [ ] **EditPart trait** - ç¼–è¾‘éƒ¨ä»¶
- [ ] **GraphicalEditPart** - å›¾å½¢ç¼–è¾‘éƒ¨ä»¶
- [ ] **EditPolicy trait** - ç¼–è¾‘ç­–ç•¥
- [ ] **SelectionEditPolicy** - é€‰æ‹©ç­–ç•¥
- [ ] **DragEditPolicy** - æ‹–æ‹½ç­–ç•¥

### é˜¶æ®µäº”ï¼šé«˜çº§å›¾å½¢

- [ ] **PolylineFigure** - å¤šæ®µçº¿
- [ ] **PolygonFigure** - å¤šè¾¹å½¢
- [ ] **TextFigure** - æ–‡æœ¬ï¼ˆåæœŸï¼‰

---

## å·²åˆ é™¤/ä¸è®¡åˆ’å®ç°

ä»¥ä¸‹åŠŸèƒ½å·²ä»æ‰§è¡Œæ¸…å•ä¸­ç§»é™¤ï¼š

- ~~novadraw-gef crate~~ â†’ éœ€é‡æ–°è¯„ä¼°æ˜¯å¦éœ€è¦ç‹¬ç«‹ crateï¼Œæˆ–åˆå¹¶åˆ° novadraw-scene
- ~~ScalableFigure~~ â†’ åŠŸèƒ½ç®€åŒ–ï¼Œæ— éœ€è£…é¥°å™¨
- ~~Region æ•°æ®ç»“æ„~~ â†’ Vello å†…ç½®åŒºåŸŸå¤„ç†
- ~~è„çŸ©å½¢è·Ÿè¸ª~~ â†’ Vello å¢é‡æ¸²æŸ“æ”¯æŒ
- ~~QuadTree~~ â†’ å½“å‰åœºæ™¯è§„æ¨¡ä¸éœ€è¦
- ~~LOD ç»†èŠ‚å±‚æ¬¡~~ â†’ åæœŸä¼˜åŒ–
- ~~Tile çº¹ç†ç¼“å­˜~~ â†’ åæœŸä¼˜åŒ–
- ~~SVG/PDF å¯¼å‡º~~ â†’ åæœŸå®ç°
- ~~image crate å›¾åƒ~~ â†’ åæœŸå®ç°

---

## æŠ€æœ¯é€‰å‹

| æ¨¡å— | æŠ€æœ¯é€‰å‹ |
|------|----------|
| çª—å£ç®¡ç† | winitï¼ˆå¯æ›¿æ¢ï¼‰ |
| æ¸²æŸ“å¼•æ“ | Vello â†’ wgpu |
| æ•°å­¦åº“ | glam / è‡ªç ” novadraw-math |
| å¼‚æ­¥è¿è¡Œæ—¶ | æ— ï¼ˆå•çº¿ç¨‹ä¼˜å…ˆï¼‰ |

---

## æ¸²æŸ“éªŒè¯ç»“æœ

éªŒè¯ Trampoline æ¸²æŸ“å¾ªç¯çš„æ­£ç¡®æ€§ï¼Œé€’å½’/è¿­ä»£ä¸¤ç§å®ç°è¡Œä¸ºä¸€è‡´ã€‚

| åœºæ™¯ | éªŒè¯ç›®æ ‡ | ç»“æœ |
|------|----------|------|
| 1 | åµŒå¥—çˆ¶å­ï¼šparent.PaintBorder åœ¨å­èŠ‚ç‚¹åæ‰§è¡Œ | âœ… |
| 2 | Z-orderï¼šåæ·»åŠ çš„é®æŒ¡å…ˆæ·»åŠ çš„ | âœ… |
| 3 | ä¸å¯è§ï¼šhidden èŠ‚ç‚¹ä¸äº§ç”Ÿå‘½ä»¤ | âœ… |
| 4 | é€‰ä¸­é«˜äº®ï¼šhighlight åœ¨ border ä¹‹å | âœ… |
| 5 | Clip è£å‰ªï¼šå­å…ƒç´ è¶…å‡ºçˆ¶è¾¹ç•Œè¢«æ­£ç¡®è£å‰ª | â³ å¾…éªŒè¯ |

**ç»“è®º**ï¼šæ¸²æŸ“å¾ªç¯é€»è¾‘æ­£ç¡®ï¼Œç¬¦åˆ Draw2D è§„èŒƒã€‚

---

## å¿«é€Ÿå¼€å§‹

```bash
# è¿è¡Œç¼–è¾‘å™¨
cargo run -p editor

# è¿è¡Œæµ‹è¯•
cargo test --workspace
```

---

## é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| **M1: åŸºç¡€æ¡†æ¶** | âœ… å·²å®Œæˆ | math, core, render, scene æ ¸å¿ƒç»“æ„ |
| **M2: æ¸²æŸ“ç®¡çº¿** | âœ… å·²å®Œæˆ | Vello åç«¯, RenderCommand, NdCanvas |
| **M3: åœºæ™¯å›¾** | âœ… å·²å®Œæˆ | Figure, SceneGraph, Viewport |
| **M4: åŸºç¡€ Figure** | âœ… å·²å®Œæˆ | RectangleFigure |
| **M5: ç¼–è¾‘å™¨åŸºç¡€** | âœ… å·²å®Œæˆ | winit é›†æˆ, SceneManager |
| **M6: å˜æ¢ç³»ç»Ÿ** | â³ å¾…å®ç° | Transform å®Œå–„ |
| **M7: æ›´å¤š Figure** | â³ å¾…å®ç° | Ellipse, Line, Path |
| **M8: ç¼–è¾‘å™¨å·¥å…·** | â³ å¾…å®ç° | Selection, Drag, Resize |
| **M9: GEF æ¡†æ¶** | â³ å¾…å®ç° | Command, EditPart, EditPolicy |
| **M10: æ¸å˜ä¸æ•ˆæœ** | ğŸ“‹ è®¡åˆ’ | åæœŸå®ç° |
| **M11: æ–‡æœ¬æ”¯æŒ** | ğŸ“‹ è®¡åˆ’ | åæœŸå®ç° |
