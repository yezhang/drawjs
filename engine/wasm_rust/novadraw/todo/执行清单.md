# Novadraw æ‰§è¡Œæ¸…å•

## é¡¹ç›®ç›®æ ‡

å®ç°ç±»ä¼¼ Eclipse Draw2D/GEF çš„çŸ¢é‡å›¾ç»˜å›¾å¼•æ“ï¼ŒåŸºäº WebGPU æŠ€æœ¯æ ˆï¼Œæ”¯æŒ macOS/Windowsã€Web å¹³å°ã€‚

---

## å½“å‰æ¶æ„ âœ… å·²é‡æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      novadraw                                â”‚
â”‚  (workspace åè°ƒè€…ï¼Œä»…ç»„åˆå­ crate)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼             â–¼       â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚novadraw-math â”‚ â”‚novadraw- â”‚ â”‚ novadraw- â”‚ â”‚  novadraw-   â”‚
â”‚   æ•°å­¦åº“      â”‚ â”‚  core    â”‚ â”‚  render   â”‚ â”‚   scene      â”‚
â”‚              â”‚ â”‚  æ ¸å¿ƒ    â”‚ â”‚  æ¸²æŸ“å±‚   â”‚ â”‚   åœºæ™¯å›¾      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚â€¢ Vec2/Vec3   â”‚ â”‚â€¢ Color   â”‚ â”‚â€¢ RenderCmdâ”‚ â”‚â€¢ Figure      â”‚
â”‚â€¢ Mat3        â”‚ â”‚          â”‚ â”‚â€¢ RenderCtxâ”‚ â”‚â€¢ SceneGraph  â”‚
â”‚â€¢ Rect/Point  â”‚ â”‚          â”‚ â”‚â€¢ Renderer â”‚ â”‚â€¢ Viewport    â”‚
â”‚â€¢ Transform   â”‚ â”‚          â”‚ â”‚â€¢ Vello    â”‚ â”‚â€¢ LayoutMgr   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                          â–¼                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ novadraw-gef â”‚ â”‚  apps/editor â”‚
                    â”‚  GEF æ¡†æ¶    â”‚ â”‚  ç¼–è¾‘å™¨åº”ç”¨   â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚â€¢ Command     â”‚ â”‚â€¢ winit çª—å£  â”‚
                    â”‚â€¢ EditPart    â”‚ â”‚â€¢ SceneMgr    â”‚
                    â”‚â€¢ EditPolicy  â”‚ â”‚â€¢ äº‹ä»¶å¤„ç†    â”‚
                    â”‚â€¢ Tool        â”‚ â”‚              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ¨¡å—çŠ¶æ€æ€»è§ˆ

| æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| **novadraw-math** | âœ… å®Œæˆ | Vec2, Vec3, Mat3, Rect, Transform, AffineTransform |
| **novadraw-core** | âœ… å®Œæˆ | Color é¢œè‰²ç±»å‹ |
| **novadraw-render** | âœ… å®Œæˆ | RenderCommand, RenderContext, VelloRenderer |
| **novadraw-scene** | âœ… å®Œæˆ | Figure, SceneGraph, Viewport, LayoutManager |
| **novadraw-gef** | âœ… å®Œæˆ | Command, EditPart, EditPolicy, Tool |

---

## å·²å®ŒæˆåŠŸèƒ½ âœ…

### novadraw-mathï¼ˆæ•°å­¦åº“ï¼‰

- [x] **Vec2** - 2D å‘é‡ç±»å‹
- [x] **Vec3** - 3D å‘é‡ç±»å‹
- [x] **Mat3** - 3x3 çŸ©é˜µç±»å‹
- [x] **Rect/Point/Size** - çŸ©å½¢ã€ç‚¹ã€å°ºå¯¸
- [x] **Transform** - å˜æ¢çŸ©é˜µï¼ˆå¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬ï¼‰
- [x] **AffineTransform** - ä»¿å°„å˜æ¢

### novadraw-coreï¼ˆæ ¸å¿ƒï¼‰

- [x] **Color** - RGBA é¢œè‰²ç±»å‹

### novadraw-renderï¼ˆæ¸²æŸ“å±‚ï¼‰

- [x] **RenderCommand** - æ¸²æŸ“å‘½ä»¤ IR
- [x] **RenderContext** - æ¸²æŸ“ä¸Šä¸‹æ–‡
- [x] **Renderer trait** - æ¸²æŸ“å™¨æ¥å£
- [x] **WindowProxy trait** - çª—å£æŠ½è±¡æ¥å£
- [x] **VelloRenderer** - Vello åç«¯å®ç°ï¼ˆæ”¯æŒ winitï¼‰
- [x] **WinitWindowProxy** - winit çª—å£é€‚é…å™¨

### novadraw-sceneï¼ˆåœºæ™¯å›¾ï¼‰

- [x] **Figure trait** - å›¾å½¢æ¥å£
- [x] **Rectangle** - çŸ©å½¢å›¾å½¢
- [x] **NullFigure** - ç©ºå›¾å½¢
- [x] **ScalableFigure** - å¯ç¼©æ”¾å›¾å½¢è£…é¥°å™¨ âœ… æ–°å¢
- [x] **SceneGraph** - åœºæ™¯å›¾ç®¡ç†
- [x] **RuntimeBlock** - è¿è¡Œæ—¶å—
- [x] **BlockId** - é«˜é€Ÿç´¢å¼•
- [x] **Viewport** - è§†å£ç®¡ç†ï¼ˆå¹³ç§»ã€ç¼©æ”¾ã€åæ ‡è½¬æ¢ï¼‰
- [x] **LayoutManager trait** - å¸ƒå±€ç®¡ç†å™¨æ¥å£
- [x] **FillLayout** - å¡«å……å¸ƒå±€
- [x] **XYLayout** - XY å¸ƒå±€

### novadraw-gefï¼ˆGEF æ¡†æ¶ï¼‰

- [x] **Command trait** - å‘½ä»¤æ¨¡å¼
- [x] **CommandStack** - å‘½ä»¤æ ˆï¼ˆUndo/Redoï¼‰
- [x] **EditPart trait** - ç¼–è¾‘éƒ¨ä»¶
- [x] **GraphicalEditPart** - å›¾å½¢ç¼–è¾‘éƒ¨ä»¶
- [x] **EditPolicy trait** - ç¼–è¾‘ç­–ç•¥
- [x] **SelectionEditPolicy** - é€‰æ‹©ç­–ç•¥
- [x] **DragEditPolicy** - æ‹–æ‹½ç­–ç•¥
- [x] **Tool trait** - å·¥å…·æ¥å£
- [x] **SelectionTool** - é€‰æ‹©å·¥å…·
- [x] **MarqueeTool** - æ¡†é€‰å·¥å…·
- [x] **RectangleCreationTool** - çŸ©å½¢åˆ›å»ºå·¥å…·

### apps/editorï¼ˆç¼–è¾‘å™¨ï¼‰

- [x] **winit çª—å£ç®¡ç†** - äº‹ä»¶å¾ªç¯ã€çª—å£åˆ›å»º
- [x] **SceneManager** - åœºæ™¯ç®¡ç†
- [x] **äº‹ä»¶å¤„ç†** - é¼ æ ‡ã€é”®ç›˜ã€æ»šè½®
- [x] **åæ ‡è½¬æ¢** - å±å¹• â†” ä¸–ç•Œåæ ‡
- [x] **è§†å£å¯¼èˆª** - å¹³ç§»ã€ç¼©æ”¾

---

## å¾…å®ŒæˆåŠŸèƒ½

### é˜¶æ®µä¸€ï¼šFigure ç³»ç»Ÿæ‰©å±•

#### åŸºç¡€ Figureï¼ˆç‹¬ç«‹ç±»å‹ï¼‰

- [ ] **EllipseFigure**ï¼ˆæ¤­åœ†ï¼‰- ç‹¬ç«‹ç±»å‹
- [ ] **CircleFigure**ï¼ˆåœ†å½¢ï¼‰- ç‹¬ç«‹ç±»å‹
- [ ] **LineFigure**ï¼ˆç›´çº¿ï¼‰- ç‹¬ç«‹ç±»å‹
- [ ] **PolylineFigure**ï¼ˆå¤šæ®µçº¿ï¼‰- ç‹¬ç«‹ç±»å‹
- [ ] **PolygonFigure**ï¼ˆå¤šè¾¹å½¢ï¼‰- ç‹¬ç«‹ç±»å‹

#### è·¯å¾„ Figure

- [ ] **PathFigure**ï¼ˆè´å¡å°”è·¯å¾„ï¼‰
  - ç›´çº¿å‘½ä»¤ï¼ˆMoveTo, LineToï¼‰
  - æ›²çº¿å‘½ä»¤ï¼ˆBezier, Quadraticï¼‰
  - å¡«å……è§„åˆ™ï¼ˆéé›¶/å¥‡å¶ï¼‰
  - æè¾¹æ”¯æŒ

#### ç»„åˆ Figure

- [ ] **FigureGroup**ï¼ˆå›¾å½¢ç»„ï¼‰
- [ ] **CompositeFigure**ï¼ˆå¤åˆå›¾å½¢ï¼‰

### é˜¶æ®µäºŒï¼šå›¾å½¢å±æ€§

- [ ] **Stroke å±æ€§** - è¾¹æ¡†å®½åº¦ã€é¢œè‰²ã€çº¿å‹ï¼ˆå®çº¿ã€è™šçº¿ã€ç‚¹çº¿ï¼‰
- [ ] **Fill å±æ€§** - çº¯è‰²å¡«å……
- [ ] **LinearGradient** - çº¿æ€§æ¸å˜ï¼ˆåæœŸï¼‰
- [ ] **RadialGradient** - å¾„å‘æ¸å˜ï¼ˆåæœŸï¼‰

### é˜¶æ®µä¸‰ï¼šGEF å·¥å…·æ‰©å±•

- [ ] **EllipseCreationTool** - æ¤­åœ†åˆ›å»ºå·¥å…·
- [ ] **LineCreationTool** - ç›´çº¿åˆ›å»ºå·¥å…·
- [ ] **PathCreationTool** - è·¯å¾„ç»˜åˆ¶å·¥å…·
- [ ] **TextTool** - æ–‡æœ¬å·¥å…·ï¼ˆåæœŸï¼‰
- [ ] **ZoomTool** - ç¼©æ”¾å·¥å…·
- [ ] **PanTool** - å¹³ç§»å·¥å…·

### é˜¶æ®µå››ï¼šEditPart å®Œå–„

- [ ] **ResizeEditPolicy** - è°ƒæ•´å¤§å°ç­–ç•¥
- [ ] **ConnectionEditPart** - è¿æ¥çº¿ç¼–è¾‘éƒ¨ä»¶ï¼ˆåæœŸï¼‰
- [ ] **ConnectionEditPolicy** - è¿æ¥ç­–ç•¥ï¼ˆåæœŸï¼‰

### é˜¶æ®µäº”ï¼šé«˜çº§åŠŸèƒ½

- [ ] **BoundsLocator** - è¾¹ç•Œå®šä½å™¨
- **Locator trait** - å®šä½å™¨æ¥å£
- [ ] **CenterLocator** - å±…ä¸­å®šä½å™¨
- [ ] **BorderLocator** - è¾¹ç•Œå®šä½å™¨

- [ ] **ChangeBoundsCommand** - è°ƒæ•´è¾¹ç•Œå‘½ä»¤
- [ ] **GroupCommand** - æˆç»„å‘½ä»¤
- [ ] **UngroupCommand** - å–æ¶ˆæˆç»„å‘½ä»¤

---

## é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| **M1: é™æ€æ¸²æŸ“** | âœ… å·²å®Œæˆ | åŸºç¡€æ¡†æ¶ã€çŸ©å½¢æ¸²æŸ“ |
| **M2: é¼ æ ‡æ‚¬åœ** | âœ… å·²å®Œæˆ | äº‹ä»¶å¤„ç†ã€å‘½ä¸­æµ‹è¯• |
| **M3: é€‰æ‹©ä¸æ‹–æ‹½** | âœ… å·²å®Œæˆ | SelectionToolã€DragEditPolicy |
| **M4: ç»˜åˆ¶å·¥å…·** | âœ… å·²å®Œæˆ | RectangleCreationTool |
| **M5: æ¡†é€‰åŠŸèƒ½** | âœ… å·²å®Œæˆ | MarqueeTool |
| **M6: GEF æ¡†æ¶** | âœ… å·²å®Œæˆ | Commandã€EditPartã€EditPolicyã€Tool |
| **M7: å˜æ¢ç³»ç»Ÿ** | â³ è¿›è¡Œä¸­ | Scale/Rotate å˜æ¢æ”¯æŒ |
| **M8: æ›´å¤š Figure** | â³ è¿›è¡Œä¸­ | Ellipse, Line, Path |
| **M9: æ¸å˜ä¸æ•ˆæœ** | ğŸ“‹ è®¡åˆ’ | åæœŸå®ç° |
| **M10: æ–‡æœ¬æ”¯æŒ** | ğŸ“‹ è®¡åˆ’ | åæœŸå®ç° |

---

## å·²åˆ é™¤/ä¸è®¡åˆ’å®ç°

ä»¥ä¸‹åŠŸèƒ½å·²ä»æ‰§è¡Œæ¸…å•ä¸­ç§»é™¤ï¼š

- ~~Region æ•°æ®ç»“æ„~~ â†’ Vello å†…ç½®åŒºåŸŸå¤„ç†
- ~~è„çŸ©å½¢è·Ÿè¸ª~~ â†’ Vello å¢é‡æ¸²æŸ“æ”¯æŒ
- ~~QuadTree~~ â†’ å½“å‰åœºæ™¯è§„æ¨¡ä¸éœ€è¦
- ~~LOD ç»†èŠ‚å±‚æ¬¡~~ â†’ åæœŸä¼˜åŒ–
- ~~Tile çº¹ç†ç¼“å­˜~~ â†’ åæœŸä¼˜åŒ–
- ~~SVG/PDF å¯¼å‡º~~ â†’ åæœŸå®ç°
- ~~image crate å›¾åƒ~~ â†’ åæœŸå®ç°

---

## æŠ€æœ¯é€‰å‹

| æ¨¡å— | æŠ€æœ¯é€‰å‹ |
|------|----------|
| çª—å£ç®¡ç† | winitï¼ˆå¯æ›¿æ¢ï¼‰ |
| æ¸²æŸ“å¼•æ“ | Vello â†’ wgpu |
| æ•°å­¦åº“ | glam / è‡ªç ” novadraw-math |
| å¼‚æ­¥è¿è¡Œæ—¶ | æ— ï¼ˆå•çº¿ç¨‹ä¼˜å…ˆï¼‰ |

---

## å¿«é€Ÿå¼€å§‹

```bash
# è¿è¡Œç¼–è¾‘å™¨
cargo run -p editor

# è¿è¡Œæµ‹è¯•
cargo test --workspace
```

