# 渲染主循环验证清单

验证 Trampoline 渲染循环的正确性，共分 4 个场景。

---

## 场景 1：嵌套父子结构 ✅ 完成

**验证目标**：`parent.PaintBorder` 在所有子节点完成后执行

**场景结构**：

```
┌────────────────────────────────────────┐
│  ┌────────────────────────────────┐    │
│  │  Parent (深紫)                 │    │
│  │  ┌──────────────────┐          │    │
│  │  │ Child (橙色)     │          │    │
│  │  │ ┌──────────┐    │          │    │
│  │  │ │ Grand    │    │          │    │
│  │  │ │ (青色,选中)│    │          │    │
│  │  │ └──────────┘    │          │    │
│  │  └──────────────────┘          │    │
│  └────────────────────────────────┘    │
└────────────────────────────────────────┘
```

**验证结果**：✅ 通过

- 嵌套层级正确渲染
- Grandchild 高亮在 border 之后
- Parent.PaintBorder 在所有子节点完成后执行

---

## 场景 2：Z-order 叠加测试 ✅ 完成

**验证目标**：后添加的节点视觉上在上层（遮挡先添加的）

**场景结构**：

```
┌────────────────────────────────────────┐
│  ┌────────────────────────────┐        │
│  │ Z-Order Parent (深灰)      │        │
│  │ ┌────────────────┐        │        │
│  │ │ A (红色,先添加)│        │        │
│  │ │  ┌──────────┐  │        │        │
│  │ │  │B (蓝色,后)│  │  ← B   │        │
│  │ │  │  覆盖 A   │  │   上层  │        │
│  │ │  └──────────┘  │        │        │
│  │ └────────────────┘        │        │
│  └────────────────────────────┘        │
└────────────────────────────────────────┘
```

**验证结果**：✅ 通过

- 后添加的 B 在上层，遮挡 A 的重叠区域
- 渲染顺序：A 先渲染在下层，B 后渲染在上层

---

## 场景 3：不可见节点过滤测试 ✅ 完成

**验证目标**：`is_visible = false` 的节点不产生任何渲染命令

**场景结构**：

```
┌────────────────────────────────────────┐
│  ┌────────────────────────────┐        │
│  │ Visible A (红色)           │        │
│  └────────────────────────────┘        │
│  ┌────────────────────────────┐        │
│  │ Hidden B (蓝色, 不可见)    │  ← 不渲染
│  └────────────────────────────┘        │
│  ┌────────────────────────────┐        │
│  │ Visible C (绿色)           │        │
│  └────────────────────────────┘        │
└────────────────────────────────────────┘
```

**验证结果**：✅ 通过

- B 完全不产生渲染命令
- A 和 C 正常显示

---

## 场景 4：选中高亮测试 ✅ 完成

**验证目标**：`paint_highlight` 在 `PaintBorder` 之后执行

**场景结构**：

```
┌────────────────────────────────────────┐
│  ┌────────────────────────────┐        │
│  │ Normal (灰色, 未选中)      │        │
│  └────────────────────────────┘        │
│                                        │
│  ┌────────────────────────────┐        │
│  │ Selected (紫色, 橙色高亮)  │        │
│  └────────────────────────────┘        │
└────────────────────────────────────────┘
```

**验证结果**：✅ 通过

- 选中节点显示橙色高亮边框
- highlight 在 PaintBorder 之后执行

---

## 验证总结

| 场景 | 验证目标 | 结果 |
|------|----------|------|
| 1 | 嵌套父子：parent.PaintBorder 在子节点后执行 | ✅ |
| 2 | Z-order：后添加的遮挡先添加的 | ✅ |
| 3 | 不可见：hidden 节点不产生命令 | ✅ |
| 4 | 选中高亮：highlight 在 border 之后 | ✅ |

**结论**：Trampoline 渲染循环逻辑正确，符合 Draw2D 规范。

---

## 执行记录

- 场景 4（选中高亮）：2026-01-13
- 场景 3（不可见过滤）：2026-01-13
- 场景 2（Z-order）：2026-01-13
- 场景 1（嵌套父子）：2026-01-13

---

## 运行命令

```bash
cargo run --package editor
```
